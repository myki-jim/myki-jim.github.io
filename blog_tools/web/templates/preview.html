{% extends "base.html" %}

{% block title %}博客预览 - Hexo 写作工具{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-10">
        <div class="card">
            <div class="card-header">
                <h4 class="mb-0"><i class="bi bi-eye"></i> 博客预览</h4>
            </div>
            <div class="card-body text-center">
                <div class="mb-4">
                    <i class="bi bi-globe display-1 text-primary"></i>
                    <h2 class="mt-3">博客预览</h2>
                    <p class="text-muted">点击下方按钮在不同的环境中预览你的博客</p>
                </div>

                <div class="row">
                    <div class="col-md-4 mb-3">
                        <div class="card h-100">
                            <div class="card-body">
                                <i class="bi bi-laptop display-4 text-success mb-3"></i>
                                <h5>本地预览</h5>
                                <p class="text-muted">在本地环境中预览博客</p>
                                <button class="btn btn-success" onclick="openLocalPreview()">
                                    <i class="bi bi-play-circle"></i> 启动本地服务器
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4 mb-3">
                        <div class="card h-100">
                            <div class="card-body">
                                <i class="bi bi-cloud display-4 text-info mb-3"></i>
                                <h5>在线预览</h5>
                                <p class="text-muted">查看已部署的博客</p>
                                <a href="https://myki-jim.github.io" target="_blank" class="btn btn-info">
                                    <i class="bi bi-globe"></i> 打开在线博客
                                </a>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4 mb-3">
                        <div class="card h-100">
                            <div class="card-body">
                                <i class="bi bi-phone display-4 text-warning mb-3"></i>
                                <h5>移动端预览</h5>
                                <p class="text-muted">模拟移动设备浏览</p>
                                <button class="btn btn-warning" onclick="openMobilePreview()">
                                    <i class="bi bi-phone"></i> 移动端视图
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="mt-4">
                    <div class="alert alert-info">
                        <i class="bi bi-info-circle"></i>
                        <strong>提示：</strong>
                        <ul class="mb-0 mt-2">
                            <li>本地预览需要先启动 Hexo 服务器：<code>npx hexo server</code></li>
                            <li>在线预览显示的是已部署到 GitHub Pages 的版本</li>
                            <li>移动端预览将在新窗口中打开移动设备模拟视图</li>
                        </ul>
                    </div>
                </div>

                <div class="mt-3">
                    <a href="{{ url_for('index') }}" class="btn btn-secondary">
                        <i class="bi bi-arrow-left"></i> 返回写作工具
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
function openLocalPreview() {
    window.open('http://localhost:4000', '_blank');
}

function openMobilePreview() {
    const mobileWidth = 375;
    const mobileHeight = 667;
    const left = (screen.width - mobileWidth) / 2;
    const top = (screen.height - mobileHeight) / 2;

    const mobileWindow = window.open(
        'http://localhost:4000',
        'mobilePreview',
        `width=${mobileWidth},height=${mobileHeight},left=${left},top=${top},resizable=yes,scrollbars=yes`
    );
}

// 检查本地服务器状态
fetch('/api/server_status')
    .then(response => response.json())
    .then(data => {
        if (data.status !== 'running') {
            // 显示服务器未启动提示
            const alert = document.createElement('div');
            alert.className = 'alert alert-warning alert-dismissible fade show';
            alert.innerHTML = `
                <i class="bi bi-exclamation-triangle"></i>
                <strong>本地服务器未启动</strong>
                请在终端中运行 <code>npx hexo server</code> 来启动本地预览服务器
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            document.querySelector('.card-body').prepend(alert);
        }
    })
    .catch(error => {
        console.log('无法检查服务器状态');
    });
</script>
{% endblock %}